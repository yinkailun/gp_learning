## IO
### 概念
1. 用户空间和内核(kernel)空间
    - 进程运行在内核空间处于内核态（cpu可以执行任何指令，不受限制），运行在用户空间处于用户态（须经过内核检查）
    - CPU将特权等级分为ring0-ring3,linux只用到ring0（内核态，可直接操作内核空间）,ring3(用户态)。
    - 所有系统资源管理都是在内核中完成(eg.磁盘文件读写，分配回收内存，从网络接口读写数据等...)，应用程序操作需要通过内核空间提供的接口来完成，不能直接操作，由此从用户空间转到内核空间。
    - 操作系统的核心是内核空间，为了避免用户直接操作内存空间，导致系统异常影响其他进程。
    - 应用程序在内核态和用户态各有一个堆栈空间
2. 文件描述符(file descriptor fd,非负整数)
    - linux有一个task_struct结构来维护进程相关的表，叫进程结构快这个块里有指针指向file_struct(文件描述表)，文件描述符(fd)就是这个表的索引,file_struct记录了文件的相关信息。
    - 进程无法直接访问文件，只能通过文件描述表的文件描述找到相关文件。
    - 文件描述表一般指向一个file结构体，文件结构体内容有：
        * count:引用计数，记录有几个文件描述符指向该file，（fd1,fd2同时指向该文件，count = 2.close(fd1)并不能真正关闭文件，只是将count-1 = 1,此时close(fd2)才会真正关闭文件）
        * position 读写位置
        * operation:操作类型
        * dentry(direct entry 目录项)
3. 缓存IO
4. 阻塞/非阻塞，同步/异步
    * 在一个CPU核心上，同时只能运行一个进程
    * 阻塞：进程在发起一个系统调用(system call,内核空间处理，如I/O请求)，由于不能立即完成，内核kernel将process挂起，设为waiting,不占用CPU
    * 同步：执行一个操作，(例如计算某个值)，只有全部执行完，程序才会继续往下走。
    * 非阻塞I/O，异步I/O
        - 非阻塞，获取结果read会立刻获取，但数据可能不完整也可能为空
        - 异步，获取的数据必须是完整的，不过可能会有一定延迟
### 场景
1. 文件IO
2. 网络IO
### IO模型(unix网络编程分为五种)
1. BIO(blocking-i/o)阻塞IO
    - 阻塞io,以套接字接口为例，应用程序用户空间recefrom内核空间数据包，其调用只有当数据包完全复制到用户空间或者发生错误才返回，否则会一直等待。
2. NIO(non-blocking-i/o)非阻塞IO
    - 应用进程调用recefrom，当数据没有准备好时会返回EWOULDBLOCK，进程反复检查该状态，若准备好，则接受数据。
3. 多路复用IO
4. 信号驱动IO
5. 异步IO
